#!/bin/bash

LOCAL_PATHS=($(cat /etc/paths))

for LOCAL_PATH in "${LOCAL_PATHS[@]}"; do
  PATH=$LOCAL_PATH:$PATH
done

ESLINT="node_modules/.bin/eslint"

if [[ ! -x "$ESLINT" ]]; then
  printf "eslint를 설치해 주세요.(npm install eslint)\n"
  exit 1
fi

STAGED_FILES=($(git diff --cached --name-only --diff-filter=d | grep -E "\.(js|jsx)$"))

if [[ "$STAGED_FILES" = "" ]]; then
  exit 0
fi

$ESLINT "${STAGED_FILES[@]}" --fix

if [ $? -ne 0 ]; then
  echo "린트에 통과하지 못한 파일이 있습니다. 확인 후 다시 시도해주세요."
  exit 1
fi

git add "${STAGED_FILES[@]}"

exit 0
